@(connections: Seq[(org.ogf.schemas.nsi._2013._07.connection.types.QuerySummaryResultType, Seq[nl.surfnet.safnari.ConnectionData])])

@import nl.surfnet.safnari._

@main("Connections", "connections") {
<section>
    <h1>Connections <span class="header-right">filtered: end time no older than a week</span></h1>
    <div class="content">

        @if(connections.isEmpty) {
            No Connections found
        } else {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th></th>
                        <th>ConnectionId</th>
                        <th>Description</th>
                        <th>LSM</th>
                        <th>RSM</th>
                        <th>PSM</th>
                        <th>DSM</th>
                    </tr>
                </thead>
                <tbody>
                    @for((connection, segments) <- connections) {
                        <tr class="rowdetails">
                            <td class="center">
                                <i class="icon-plus-sign"></i>
                                <i class="icon-minus-sign"></i>
                                <div class="rowdetails-content">
                                    <div class="row-fluid">
                                        <div class="span6">
                                            <dl class="dl-horizontal">
                                                <dt>Start</dt>
                                                <dd>@nullable(connection.getCriteria().head.getSchedule().getStartTime())</dd>
                                                <dt>Bandwidth</dt>
                                                <dd>@connection.getCriteria().head.getPointToPointService().map(_.getCapacity()).getOrElse("unknown")</dd>
                                                <dt>Global id</dt>
                                                <dd>@nullable(connection.getGlobalReservationId())</dd>
                                            </dl>
                                        </div>
                                        <div class="span6">
                                            <dl class="dl-horizontal">
                                                <dt>End</dt>
                                                <dd>@nullable(connection.getCriteria().head.getSchedule().getEndTime())</dd>
                                                <dt>Version</dt>
                                                <dd>@connection.getCriteria().head.getVersion()</dd>
                                                <dt>Requester</dt>
                                                <dd>@connection.getRequesterNSA()</dd>
                                            </dl>
                                        </div>
                                            <dl class="dl-horizontal">
                                                <dt>Source</dt>
                                                <dd>@connection.getCriteria().head.getPointToPointService().map(_.getSourceSTP()).map(stp).getOrElse("unknown")</dd>
                                                <dt>Destination</dt>
                                                <dd>@connection.getCriteria().head.getPointToPointService().map(_.getDestSTP()).map(stp).getOrElse("unknown")</dd>
                                            </dl>
                                    </div>
                                    @if(segments.isEmpty) {
                                        <strong>No Child Connections</strong>
                                    } else {
                                        <table class="table table-bordered table-striped">
                                            <thead>
                                                <tr>
                                                    <th>ConnectionId</th>
                                                    <th>NSA</th>
                                                    <th>LSM</th>
                                                    <th>RSM</th>
                                                    <th>PSM</th>
                                                    <th>DSM</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @for(segment <- segments) {
                                                    <tr>
                                                        <td>@{segment.connectionId.getOrElse("<unknown>")}</td>
                                                        <td>@segment.providerNsa</td>
                                                        <td>@segment.lifecycleState</td>
                                                        <td>@segment.reservationState</td>
                                                        <td>@segment.provisionState</td>
                                                        <td>@segment.dataPlaneStatus</td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    }
                                </div>
                            </td>
                            <td>@connection.getConnectionId()</td>
                            <td>@connection.getDescription()</td>
                            <td>@connection.getConnectionStates().getLifecycleState()</td>
                            <td>@connection.getConnectionStates().getReservationState()</td>
                            <td>@connection.getConnectionStates().getProvisionState()</td>
                            <td>@connection.getConnectionStates().getDataPlaneStatus().isActive()</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</section>

}

@stp(stp: org.ogf.schemas.nsi._2013._07.services.types.StpType) = {
    @stp.getNetworkId() @@ @stp.getLocalId()
}
@nullable(field: Any) = @{
    if (field == null) "-" else field
}
